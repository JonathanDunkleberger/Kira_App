services:
  - type: web
    name: kira-voice-ws
    env: node
    rootDir: ai-media-companion/packages/socket-server
    plan: starter
    region: oregon
    buildCommand: |
      npm ci --no-audit --no-fund --progress=false
      npm run prisma:generate
      npm run build:server
    startCommand: npm run prisma:deploy && npm run start:server
    envVars:
      - key: NODE_VERSION
        value: 20.12.2
      - key: DATABASE_URL
        sync: false
      - key: DIRECT_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: AZURE_SPEECH_KEY
        sync: false
      - key: AZURE_SPEECH_REGION
        sync: false
      - key: SUPABASE_URL
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: DEV_ALLOW_NOAUTH
        value: 'false'
    healthCheckPath: /healthz
