services:
  - type: web
    name: kira-voice-ws
    env: node
    rootDir: packages/socket-server # Adjusted rootDir to be relative from monorepo root if needed
    plan: starter
    region: oregon
    buildCommand: |
      npm ci --no-audit --no-fund --progress=false
      npm run prisma:generate
      npm run build:server
    startCommand: npm run prisma:deploy && npm run start:server
    envVars:
      - key: NODE_VERSION
        value: 20.12.2
      - key: DATABASE_URL
        fromDatabase:
          name: your-db-name # Replace with your Render database name
          property: connectionString
      - key: DIRECT_URL
        fromDatabase:
          name: your-db-name # Replace with your Render database name
          property: directConnectionString
      - key: OPENAI_API_KEY
        sync: false
      - key: DEEPGRAM_API_KEY   # <-- ADDED THIS
        sync: false
      - key: AZURE_SPEECH_KEY
        sync: false
      - key: AZURE_SPEECH_REGION
        sync: false
      - key: DEV_ALLOW_NOAUTH
        value: 'false'
    healthCheckPath: /healthz
