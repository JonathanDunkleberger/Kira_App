--- START OF FILE: packages/web/package.json ---
{
  "name": "web",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint"
  },
  "dependencies": {
    "@clerk/nextjs": "^5.2.3",
    "@radix-ui/react-slot": "^1.1.0",
    "class-variance-authority": "^0.7.0",
    "clsx": "^2.1.1",
    "lucide-react": "^0.407.0",
    "next": "14.2.5",
    "react": "^18",
    "react-dom": "^18",
    "stripe": "^16.2.0",
    "tailwind-merge": "^2.4.0",
    "tailwindcss-animate": "^1.0.7",
    "zustand": "^4.5.4"
  },
  "devDependencies": {
    "@types/node": "^20",
    "@types/react": "^18",
    "@types/react-dom": "^18",
    "eslint": "^8",
    "eslint-config-next": "14.2.5",
    "postcss": "^8",
    "tailwindcss": "^3.4.1",
    "typescript": "^5"
  }
}
--- END OF FILE: packages/web/package.json ---


--- START OF FILE: packages/server/package.json ---
{
  "name": "server",
  "version": "1.0.0",
  "private": true,
  "type": "module",
  "scripts": {
    "dev": "node --watch --enable-source-maps --env-file=../../.env dist/server.mjs",
    "build": "tsc",
    "start": "node --enable-source-maps dist/server.mjs",
    "prisma:deploy": "prisma migrate deploy"
  },
  "dependencies": {
    "@clerk/backend": "^1.3.0",
    "@google-cloud/speech": "^6.5.0",
    "@prisma/client": "^5.20.0",
    "microsoft-cognitiveservices-speech-sdk": "^1.38.0",
    "openai": "^4.52.7",
    "prisma": "^5.20.0",
    "ws": "^8.18.0"
  },
  "devDependencies": {
    "@types/node": "^20.14.10",
    "@types/ws": "^8.5.10",
    "typescript": "^5.5.3"
  }
}
--- END OF FILE: packages/server/package.json ---


--- START OF FILE: packages/web/src/app/layout.tsx ---
import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";
import { ClerkProvider } from "@clerk/nextjs";

const inter = Inter({ subsets: ["latin"] });

export const metadata: Metadata = {
  title: "Kira AI",
  description: "Your AI media companion",
};

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode;
}>) {
  return (
    <ClerkProvider>
      <html lang="en">
        <body className={`${inter.className} bg-kira-bg text-gray-900`}>
          {children}
        </body>
      </html>
    </ClerkProvider>
  );
}
--- END OF FILE: packages/web/src/app/layout.tsx ---


--- START OF FILE: packages/web/src/app/page.tsx ---
import { UserButton, auth } from "@clerk/nextjs";
import Link from "next/link";
import { Phone } from "lucide-react";

export default function HomePage() {
  const { userId } = auth();

  return (
    <div className="flex flex-col items-center justify-center min-h-screen p-4">
      <header className="absolute top-0 left-0 right-0 p-4 flex justify-between items-center">
        <span className="font-semibold text-lg">Kira</span>
        {userId ? (
          <UserButton afterSignOutUrl="/" />
        ) : (
          <Link
            href="/sign-in"
            className="px-4 py-2 bg-gray-200 rounded-lg text-sm font-medium"
          >
            Log in
          </Link>
        )}
      </header>

      <main className="flex flex-col gap-4 w-full max-w-sm">
        <Link
          href="/chat/kira"
          className="flex items-center justify-center gap-3 p-8 bg-kira-green rounded-lg text-2xl font-medium text-gray-800 hover:opacity-90 transition-opacity"
        >
          <Phone size={24} />
          <span>Talk to Kira</span>
        </Link>
      </main>

      <footer className="absolute bottom-4 text-xs text-gray-400">
        By using our services, you agree to our Terms and Privacy Policy.
      </footer>
    </div>
  );
}
--- END OF FILE: packages/web/src/app/page.tsx ---


--- FILE NOT FOUND: packages/web/src/app/(auth)/sign-in/[[...sign-in]]/page.tsx ---


--- FILE NOT FOUND: packages/web/src/app/(auth)/sign-up/[[...sign-up]]/page.tsx ---


--- FILE NOT FOUND: packages/web/src/app/api/webhooks/clerk/route.ts ---


--- FILE NOT FOUND: packages/web/src/app/api/webhooks/stripe/route.ts ---


--- FILE NOT FOUND: packages/web/src/lib/stripe.ts ---


--- FILE NOT FOUND: packages/web/src/lib/prisma.ts ---


--- FILE NOT FOUND: packages/web/src/hooks/use-subscription.ts ---


--- FILE NOT FOUND: packages/web/src/components/upgrade-button.tsx ---


--- START OF FILE: prisma/schema.prisma ---
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model User {
  id             String          @id @unique
  email          String          @unique
  name           String?         // Preferred display name
  tier           String          @default("free")
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  dailyUsage     DailyUsage[]
  conversations  Conversation[]
  subscriptions  Subscription[]
  paymentEvents  PaymentEvent[]

  @@map("User")
}

model DailyUsage {
  id          String   @id @default(cuid())
  userId      String?
  user        User?    @relation(fields: [userId], references: [id], onDelete: Cascade)
  guestId     String?
  day         DateTime @db.Date
  secondsUsed Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([userId, day])
  @@unique([guestId, day])
}

model Conversation {
  id        String    @id @default(cuid())
  userId    String?   // optional for guests
  user      User?     @relation(fields: [userId], references: [id])
  guestId   String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  isGuest   Boolean   @default(true)
  title     String    @default("New Conversation")
  messages  Message[]
  feedbacks Feedback[]
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  role           String
  text           String
  createdAt      DateTime     @default(now())
}

model Feedback {
  id             String        @id @default(cuid())
  stars          Int
  note           String?
  conversationId String?
  conversation   Conversation? @relation(fields: [conversationId], references: [id], onDelete: SetNull)
  userId         String?
  createdAt      DateTime      @default(now())
}

model Subscription {
  id               String     @id @default(cuid())
  userId           String
  user             User       @relation(fields: [userId], references: [id])
  stripeCustomer   String?    @unique
  stripeSubId      String?    @unique
  status           String     @default("inactive")
  plan             String     @default("pro")
  currentPeriodEnd DateTime?
  cancelAt         DateTime?
  canceledAt       DateTime?
  createdAt        DateTime   @default(now())
  updatedAt        DateTime   @updatedAt

  @@index([userId])
  @@map("app_subscriptions")
}

model PaymentEvent {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  stripeId    String   @unique
  type        String
  status      String?
  amountCents Int?
  currency    String?  @default("usd")
  raw         Json
  createdAt   DateTime @default(now())

  @@index([userId, createdAt])
  @@map("app_payment_events")
}
--- END OF FILE: prisma/schema.prisma ---


